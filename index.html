<!DOCTYPE html>
<!-- Page mostly generated by ChatGPT + some small changes from me. -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>3D Printer Dry Fillament</title>
    <style>
        body { font-family: Arial, sans-serif; zoom: 2; }
        .container { width: 600px; margin: 20px auto; }
        .form-group { margin-bottom: 10px; }
        .form-group label { display: block; }
		p { margin: 2px; }
		hr { margin-bottom: 20px; }
	</style>
</head>
<body>
    <div class="container">
        <h2>3D Printer Dry Fillament (<a href="https://github.com/legraphista/basic-filament-drying-gcode-generator/tree/master">Github</a>, <a href="https://www.printables.com/model/702117-filament-drying-gcode-generator">Printables</a>)</h2>
		<p>Generate GCode to dry fillaments based on <a target="_blank" href="https://wiki.bambulab.com/knowledge-sharing/filament-drying-cover/%E4%B8%8D%E5%90%8C%E8%80%97%E6%9D%90%E7%83%98%E5%B9%B2%E6%9D%A1%E4%BB%B6en.png">this</a> reference.</p>
		
		<hr/>

        <div class="form-group">
            <label for="temperature">Temperature:</label>
            <select id="temperature">
                <option value="70" selected>PLA / PLA-CF / GF = 70C</option>
                <option value="80">PETG / PETG-CF = 80C</option>
                <option value="85">TPU = 85C</option>
                <option value="95">PC = 95C</option>
                <option value="95">ABS / ASA = 95C</option>
                <option value="95">PET-CF / GF = 95C</option>
                <option value="95">PA / PA-CF / GF / PAHT-CF / GF = 95C</option>
            </select>
        </div>

        <div class="form-group">
            <label for="waitTime">Wait Time (hours):</label>
            <select id="waitTime"> 
                <option value="2">2 hours</option>
                <option value="3">3 hours</option>
                <option value="4">4 hours</option>
                <option value="6" selected>6 hours</option>
                <option value="8">8 hours</option>
                <option value="10">10 hours</option>
                <option value="12">12 hours</option>
            </select>
        </div>

        <div class="form-group">
            <label for="fanNumber">Fan Number:</label>
            <select id="fanNumber">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3" selected>3</option>
            </select>
        </div>

        <div class="form-group">
            <label for="fanSpeed">Fan Speed (%):</label>
            <input type="number" id="fanSpeed" value="40" min="0" max="100">
        </div>

        <div class="form-group" style="display:flex">
            <input type="checkbox" id="enableHoming" onchange="toggleZHeight(this)">
            <label for="enableHoming">Enable Homing and Z-axis Positioning</label>
        </div>

        <div class="form-group" id="zHeightGroup" style="display: none;">
            <label for="zHeight">Z-Axis Height (mm):</label>
            <input type="number" id="zHeight" min="0" value="150">
			<br/>
			<i>
			<p>This sets how low/how far the Z-Axis will move.</p>
			<p>Be careful to set it to a safe value for your printer</p>
			</i>
        </div>

		<hr/>

		<div class="form-group" style="display:flex">
            <input type="checkbox" id="enableGenerate" onchange="toggleGenerate(this)">
            <label for="enableGenerate">I acknowledge that all the values are safe for my printer and I am responsible for any hardware damage that may occur.</label>
        </div>


        <button disabled onclick="generateAndDownloadGCode()" id="generate">Generate and Download G-Code</button>
    </div>

    <script>
        function toggleZHeight(checkbox) {
            var zHeightGroup = document.getElementById('zHeightGroup');
            zHeightGroup.style.display = checkbox.checked ? 'block' : 'none';
        }
		function toggleGenerate(checkbox) {
			document.getElementById('generate').disabled = checkbox.checked ? false : true;
		}
		

        function generateAndDownloadGCode() {
            var temperature = document.getElementById('temperature').value;
            var waitTime = document.getElementById('waitTime').value * 3600; // Convert hours to seconds
            var fanNumber = document.getElementById('fanNumber').value;
            var fanSpeed = Math.round(255 * (document.getElementById('fanSpeed').value / 100)); // Convert percentage to 0-255 scale
            var enableHoming = document.getElementById('enableHoming').checked;
            var zHeight = enableHoming ? document.getElementById('zHeight').value : '';

            var gcode = '; GCode generated by 3D Printer Dry Fillament\n';

            if (enableHoming) {
                gcode += '; Homing XY axes\n';
                gcode += 'G28 X Y\n';
                gcode += '; Moving Z-axis to specified height\n';
                gcode += 'G1 Z' + zHeight + ' F600\n';
            }

            gcode += '; Setting bed temperature\n';
            gcode += 'M140 S' + temperature + '\n';
                       gcode += '; Setting fan speed\n';
            gcode += 'M106 P' + fanNumber + ' S' + fanSpeed + '\n';

            // Splitting the wait time into 100 equal parts
            var waitSegment = waitTime / 100;
            gcode += '; Waiting for specified duration, split into 100 parts\n';
            for (var i = 0; i < 100; i++) {
                gcode += 'G4 S' + waitSegment + ' ; Wait part ' + (i + 1) + '\n';
            }

            gcode += '; Turning off bed heating and waiting 5 minutes (300 seconds)\n';
            gcode += 'M140 S0\n';
            gcode += 'G4 S300\n';
            gcode += '; Turning off fan\n';
            gcode += 'M107 P' + fanNumber + '\n';

            downloadGCode(gcode, "dry.gcode");
        }

        function downloadGCode(content, fileName) {
            var element = document.createElement('a');
            element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(content));
            element.setAttribute('download', fileName);

            element.style.display = 'none';
            document.body.appendChild(element);

            element.click();

            document.body.removeChild(element);
        }
    </script>
</body>
</html>

